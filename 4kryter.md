Плавно переходим на то, что нужна онтология в области оборудования +  автоматика. Стандарт: Есть программа управления, которая управляет  механизмами. Идея стандарта - программа не должна привязываться к  технологии приготовления. Программа должна писаться таким образом, что в контроллере выполнялась элементарная технологическая операция - фаза -  (слить, набрать, держать температуру...). Рецепт набирается из фаз. При  этом рецепт должен быть гибким с точки зрения оборудования - один и тот  же рецепт может выполняться на разном оборудовании. Стандарт  регламентирует некоторые правила того, как делать такие рецепты. На  уровне рецепта нет например клапана. Есть оборудование, которое не имеет фаз. Есть разные уровни с точки зрения стандарта. Базовое управление  может быть только у control module, а их не может быть в рецепте. Нужен  equipment module. Есть кубики, из которых он собирает рецепт - кубиком может быть фаза  -> операция -> процедура аппарата (process unit процедура) ->  процедура (process cell процедура). Процедура - общее название всех  элементов или процедура самого высокого уровня (process cell процедура). procell cell процедура может быть описана на уровне фаз сразу или по  иерархии. Фаза ссылается на фазу в рамках оборудования. При этом  возможно чтобы кубик более высокого уровня тоже ссылался на контроллер.  Все это называется building block, из них строится. Выделение фаз делают несколько людей - нужно понимать и оборудование и сам рецепт, и то,  какие рецепты предвидятся в будущем.

## 4. О ISA-88 и критериях декомпозиции технологии и оборудования (Пупена, Иванюк).

Как уже было отмечено выше при создании иерархии оборудования инженер сталкивается с рядом проблем, связанными с необходимостью учета многих факторов. Чем больше технологическая схема с точки зрения количества оборудования и чем больше в ней связей, тем сложнее выделять в ней логически связанное оборудование. Трудность также заключается в том, что в стандарте нет и не может быть всех критериев выделения. По-этому эту задачу следует рассматривать как с точки зрений ограничений и функциональных требований стандарта ISA-88, так и с точки зрения опыта и лучших практик. И одно и другое можно заложить в базу знаний. 

Для начала выделим четкие ограничения, используя которые можно достаточно легко определить принадлежность оборудования к одному из уровней иерархии. Согласно ISA-88 этими уровнями есть:

- Process Cell
- Unit (Batch Unit)
- Equipment Module
- Control Module

Согласно стандарта "A process cell is a logical grouping of equipment that includes the equipment required for production of one or more batches." Именно с точки зрения производства партии выделяется Process Cell. Если вся партия полупродукта не изготовляется в границах Process Cell, значит туда нужно включать оборудование, которое для этого нужно. В границах одного Process Cell может находится несколько связанного оборудования, способного производить паралельно несколько партий. Если их нельзя разделить, они остаются в рамках одного process cell. Кроме того Process Cell должен содержать как минимум один Unit.

Немного менее очевидным является выделение Unit. Есть несколько четких критериев:

- один Unit не может содержать несколько партий
- каждое технологическое действие происходит сразу (одновременно) со всем материалом в границах одного Unit
- технологическая операция начинается и заканчивается в границах того же Unit 

Но есть и менее очевидные условия выбора и объединения:

- Unit'у могут:
  - принадлежать все Equipment Module и  Control Module участвующие в технологических действиях 
  - или подключаться при необходимости
- Unit может работать с частью партии

Все оборудования кроме Control Module может реализовывать процедурное управление (procedural control). Т.е. с точки зрения технологии оно содержит какие-то процедурные элементы, которые делают технологическую операцию, абстрагируясь от способа ее реализации. Т.е там фигурируют понятия к примеру "нагреть до нужной температуры", но не "открыть клапан 1" и не "если TE101>23 закрыть клапан". Последнее управление относится к оборудованию, а не к технологии и называется в стандарте "basic control" (базовое управление). Это основной критерий, который определяет принцип выделения  Control Module - это оборудование не содержит процедурного управления. Кроме того эта часть иерархии обеспечивает реальное взаимодействие с конкретным оборудованием, тогда как остальные уровни представляют собой больше ролевые группы. По этому уровень Control Module не может быть опущен в иерархии. 

Само по себе понятие процедурного управления (procedural control) тоже не достаточно четкое. Т.е. его трудно формализовать а значит определить в онтологии. Тем не менее, согласно стандарту есть определенные свойства, присущие ему в отличии от базового управления такие как видимость на уровне рецепта, характерный автомат состояния, абстрагирование от оборудования и т.п. 

Что касается Control Module есть еще одно косвенное, но очень полезное свойство в качестве критерия выбора - этот тип оборудования показывается на схемах P&ID как Instrumentation. Согласно стандарту Control Module может включать в себя другие Control Module организовывая комбинированные Control Module.    

Наиболее неопределенные критерии касаются Equipment Module. Во первых наличие их не является обязательным. Во вторых это группа оборудования из Equipment Module или других Control Module которая **может** содержать процедурное управление но при этом не подходит по критериям ни к Unit ни тем более к Process Cell. Наличие слова  "может" вносит путаницу, так как Equipment Module без процедурного управления имеет такой же смысл, как и Control Module. Если же принять это как строгое ограничение, то остается внести критерии, которые определяют чем  Equipment Module отличается от Unit. Тут можно задействовать критерии принадлежности к Unit (Batch Unit), и таким образом наиболее важные критерии выбора следующий:

- выполняет процедурное управление
- не работает со всей партией или частью партии одновременно

Таким образом если какое-то технологическое действие должно происходить в потоке, например подогрев/охлаждение в теплообменниках или дозирование в потоке, но в границах Process Cell то это следует отнести к Equipment Module. Если же необходимо дозировать какой-то компонент в различные Unit, то система дозирования также является Equipment Module, так как не может принадлежать какому-то Unit.

Таким образом все объекты иерархии оборудования за исключением нижнего уровня представляют собой всегда группу Control Module, которые объединены для выполнения определенной роли. Инженеру проектировщику системы управления нужно понимать как группа оборудования совместно может выполнять эти роли. Для этого база знаний, которая помогает в этом должна содержать все необходимые знания о нижнем уровне Equipment. Как уже было сказано выше - это можно сделать переместив в нее знания из схем P&ID, которые всегда присутствуют в проектной документации для Batch Production.     

